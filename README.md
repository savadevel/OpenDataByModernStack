# OpenDataByModernStack

## Общая информация
Создание пайплайна загрузки в открытых данных правительства Москвы для анализа зависимостей в BI на базе современного стека инструментов

## Цели
1. Создать пайплайн загрузки открытых данных правительства Москвы
2. Использовать современный стек инструментов
3. Анализа зависимостей в BI

## Что планировалось
1. Выбрать набор открытых данных правительства Москвы
2. Сделать контейнер сервисов 
3. Создать слои данных (STG, ODS и DDS) в DWH
4. Создать аналитические витрины (DMT) в хранилище горячих данных
5. Настроить оркестрацию загрузки данных
6. Выполнить пайплан, прогрузить данные
7. Проанализировать загруженные данные

## Используемые технологии
* Конфигурация в Docker, разделение на отдельные самостоятельные сервисы
* AirFlow – оркестратор
* dbt – трансформации, тестирование данных
* Cosmos – связка AirFlow и dbt
* PostgreSQL – хранилище данных (DWH)
* ClickHouse  - аналитические витрины
* Superset - BI

## Версии
* Docker - 25.0.3
* AirFlow - 2.8.3
* dbt - 1.7.10
* dbt plugins postgres - 1.7.10
* dbt plugins clickhouse - 1.7.3
* Cosmos - 1.3.2
* PostgreSQL - 16.2
* ClickHouse - 24.2.2.71
* Superset - 3.1.1

## Что получилось

1. Исходный набор данных “Годовой пассажиропоток по всем видам общественного транспорта в городе Москве”
![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/92118f68-e841-4af1-bc30-803fe94667fd)

2. Структура проекта
   
![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/b1c41b47-75c4-4437-9c32-b1ee9440c1a7)

4. Структура контейнеров, выделение отдельных сервисов
   
![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/4da84112-3b05-41f6-b675-6344f894f72b)

6. Код дага загрузки архива, распаковки json и загрузки данных в STG

![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/250da04d-78f4-47f0-8854-0c3bab42bfca)

7. Код дага трансформации в ODS и DDS загруженных данных из STG, а также структура соответствующего проекта dbt при использовании Cosmos для связки с Airflow

![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/dc644e75-022d-4609-8842-17ec9dfa5239)

8. Даги пайплана загрузки открытых данных правительства Москвы

![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/b3862521-7422-404c-b227-49e8c2e0eabc)

9. Граф дага трансформации загруженных данных в STG

![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/e1ea5dc7-5850-4c74-a88d-245f495c0523)

10. Анализ зависимостей в BI

![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/0dd5d432-be95-4229-9281-3acba3865cd9)

# Схема потоков данных
![image](https://github.com/savadevel/OpenDataByModernStack/assets/69199994/e0fc8ae7-aac6-4934-bcfc-e96fd1f5c40e)

# Выводы и планы по развитию
1. Выбранный стек позволят построить пайплайн загрузки данных
2. Cosmos позволяет связать AirFlow c dbt, а это дает сделать оркестрация функционала dbt из "коробки", как, например, создание моделей данных, тестирование и инкрементальную загрузку протестированных данных 
3. Дальнейшие планы по развитию:
* вынести в настройку задание наборов загружаемых открытых данных 
* минимизировать количество операций по настройки созданных контейнеров (запустил "docker compose up" и перешел к анализу данных в Superset) 
* создание инфраструктуры сделать через Terraform 
* использовать облачные ресурсы
* выстроить зависимость дагов загрузки данных
* документирование проекта 
